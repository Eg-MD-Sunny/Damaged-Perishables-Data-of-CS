
SELECT    CAST(DBO.TOBDT([ShipmentFeedback].[RecordedOn]) AS smalldatetime)	AS [Feedback_date]
		, [Shipment].[OrderId]												AS [OrderId]
		, [ProductVariant].[Id]												AS [PVID]
		, [ProductVariant].[Name]											AS [PVName]
		, [ShipmentFeedback].[ProductVariantCount]							AS [ProductVariantCount]
		, dbo.GetEnumName('ShipmentFeedbackType',ShipmentFeedbackType)		AS [Feedback_type]
		, [Warehouse].[Id]													AS [WarehouseID] 
		, [Warehouse].[Name]												AS [Warehouse] 
		

FROM [Shipment]
	JOIN [ShipmentFeedback] ON [Shipment].[Id] = [ShipmentFeedback].[ShipmentId]
	JOIN [ProductVariant] ON [ShipmentFeedback].[ProductVariantId]=[ProductVariant].[Id]
	JOIN [Warehouse] ON [Warehouse].Id = [Shipment].WarehouseId 

WHERE [Shipment].[ReconciledOn] IS NOT NULL
	AND [ShipmentFeedback].[RecordedOn] >= '2022-08-01 12:31 +6:00'
	AND [ShipmentFeedback].[RecordedOn] < '2022-09-01 19:01 +6:00'
	AND [ShipmentFeedback].[ActionByCustomerId] NOT IN (SELECT Id FROM Employee)
	AND ProductVariant.DistributionNetworkId = 1
	AND ProductVariant.Id in (2111,2115,2186,2187,3158,3161,3359,3966,3967,4175,4248,4421,5592,5593,5594,5595,5596,5597,5598,5599,5600,5601,5602,5603,5604,5605,5606,5607,5608,5609,5696,5697,5741,5752,5753,5813,5878,5880,5923,5929,5930,5931,5932,5933,5935,5936,5937,5938,6007,6008,6009,6010,6012,6013,6014,6016,6017,6018,6019,6020,6021,6022,6023,6024,6035,6036,6037,6038,6039,6041,6042,6043,6044,6221,6222,6223,6224,6226,6227,6228,6295,6296,6298,6299,6300,6301,6302,6303,6304,6306,6334,6335,6336,6337,6338,6339,6340,6341,6342,6343,6344,6345,6422,6423,6424,6449,6451,6452,6455,6456,6547,6562,6565,6581,6582,6583,6584,6617,6639,6656,6657,6658,6783,6828,6831,6838,6839,6841,6842,6843,6844,6845,6846,6847,6848,6849,6860,6927,6936,6937,6941,6957,6958,6959,6960,6961,6962,6964,6965,6976,6977,7021,7022,7023,7024,7025,7026,7027,7028,7029,7039,7047,7048,7050,7052,7109,7110,7111,7112,7113,7114,7115,7116,7117,7118,7119,7175,7200,7225,7226,7227,7228,7229,7235,7259,7260,7275,7298,7299,7300,7301,7441,7442,7443,7444,7445,7446,7643,7648,7749,7777,7786,7825,7861,8085,8102,8103,8120,8125,8131,8219,8220,8221,8222,8223,8313,8321,8322,8323,8450,8471,8474,8475,8477,8523,8526,8527,8562,8563,8564,8581,8606,8614,8623,8631,8632,8633,8634,8635,8653,8654,8655,8656,8657,8658,8659,8660,8661,8662,8663,8664,8665,8666,8715,8716,8717,8719,8720,8816,8818,8819,8820,8823,8824,8825,8826,8827,8846,8909,8914,8931,8950,9011,9091,9109,9110,9111,9116,9134,9135,9337,9338,9339,9341,9562,9571,9589,9591,9624,9743,9744,9751,9801,9804,9855,9864,9870,9871,9872,9873,9874,9875,9876,9877,9888,9889,9890,9892,9893,9905,9918,9922,9923,9930,9935,10013,10049,10050,10052,10053,10075,10076,10077,10078,10079,10080,10128,10137,10139,10174,10224,10225,10226,10285,10288,10380,10381,10382,10418,10424,10425,10426,10445,10548,10661,10688,10689,10690,10704,10705,10707,10708,10709,10726,10727,10739,10767,10778,10829,10850,10911,10912,10913,10940,10944,10974,11171,11220,11221,11395,11398,11434,11437,11515,11516,11526,11662,11694,11735,11767,11823,11844,11849,11959,12005,12023,12024,12025,12026,12267,12305,12466,12562,12576,12577,12590,12746,12941,12966,13105,13161,13162,13207,13250,13252,13320,13346,13434,13436,13442,13513,13514,13515,13516,13596,13597,13598,13602,13603,13604,13660,13668,13670,13672,13673,13675,13677,13684,13686,13687,13688,13691,13695,13711,13726,13790,13813,13889,13914,13916,14118,14119,14127,14308,14320,14447,14530,14554,14793,14819,14834,14890,14957,14963,14964,15028,15043,15055,15075,15093,15175,15302,15303,15304,15361,15544,15545,15546,15548,15564,15566,15574,15641,15644,15707,15708,15800,15935,15975,15976,15977,15980,15996,16089,16154,16155,16182,16194,16207,16270,16271,16322,16367,16368,16369,16370,16371,16377,16378,16379,16380,16431,16642,16737,16738,16963,17022,17024,17025,17084,17086,17131,18522,18523,18525,19987,20084,20085,20086,20255,20596,20874,20983,21120,21203,21333,21400,21493,21504,21625,21631,22038,22132,22134,22135,22136,22139,22140,22141,22168,22169,22179,22187,22220,22221,22222,22318,22320,22337,22338,22387,22391,22392,22450,23008,23009,23010,23025,23056,23058,23059,23060,23061,23064,23065,23068,23069,23070,23071,23080,23092,23099,23108,23109,23114,23115,23128,23144,23168,23241,23319,23368,23378,23391,23569,23570,23574,23575,23662,23740,23741,23799,23802,23825,23837,23904,24037,24048,24085,24195,24196,24282,24420,24477,24478,24609,24670,24694,24745,24762,24797,24847,26123,26171,26180,26181,26182,26184,26187,26200,26457,26575,26597,26743,26744,26779,26780,26781,26782,26856,27202,27284,27802,27804,27816,27871,28053,28080,28082,28083,28207,28208,28209,28210,28211,28212,28213,28214,28216,28217,28218,28219,28222,28223,28235,28236,28239,28241,28246,28427,28727,29476,29501,29502,29503,30112,30113,30399,30400,30402,30403,30404,30641,30648,30649,30653,30656,30658,30769,30809,30810,30876,31123,31124,31125,31126,31127,31250,31251,31252,35004,35324,35869,35898,35905,36042,36114,36153,36154,36155,36160,36394,36396)
	AND ShipmentFeedbackType IN (52)
	
group by CAST(DBO.TOBDT([ShipmentFeedback].[RecordedOn]) AS smalldatetime)
         , [Shipment].[OrderId]
		, [ProductVariant].[Id]
		, [ProductVariant].[Name]
		, [ShipmentFeedback].[ProductVariantCount]
		, dbo.GetEnumName('ShipmentFeedbackType',ShipmentFeedbackType)
		, [Warehouse].[Id]
		, [Warehouse].[Name]		





--Calculation

select pv.Id,pv.Name 
from ProductVariant pv
join ProductVariantCategoryMapping pvcm on pv.Id = pvcm.ProductVariantId 
join Category c on c.Id = pvcm.CategoryId 
where c.Id in (12,1235,1380,1696,11,61,64)
group by pv.Id,pv.Name


